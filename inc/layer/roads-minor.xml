<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE Include [
    <!ENTITY % inc SYSTEM "../inc.xml.inc">
    %inc;
]>

<Include xmlns:xi="http://www.w3.org/2001/XInclude">
	<Layer name="roads-minor" status="on" srs="&dbProjection;">
		<StyleName>roads-residential-tunnel-casing</StyleName>
		<StyleName>roads-residential-tunnel-fill</StyleName>
		
		<StyleName>roads-residential-bridge-casing</StyleName>
		<StyleName>roads-residential-bridge-fill</StyleName>
		
		<StyleName>roads-residential-casing</StyleName>
		<StyleName>roads-residential-fill</StyleName>
		
		<StyleName>roads-residential-construction</StyleName>
		<StyleName>roads-residential-access</StyleName>
		<StyleName>roads-residential-text</StyleName>
		
		<!--StyleName>roads-unclassified</StyleName-->
		<!--StyleName>roads-service</StyleName-->
		
		<Datasource>
			<Parameter name="table">
			(
			
				SELECT way, tags->'highway' AS highway, tags->'construction' AS construction, tags->'access' AS access, 
				       tags->'name' AS name, tags->'ref' AS ref, 
				  CASE WHEN tags->'tunnel' in ('yes', 'true', '1') then 'yes'::text ELSE tags->'tunnel' END AS tunnel, 
				  CASE WHEN tags->'bridge' in ('yes', 'true', '1') then 'yes'::text ELSE tags->'bridge' END AS bridge, 
				  CASE WHEN tags->'service' in ('parking_aisle', 'drive-through', 'driveway') THEN 'service-minor'::text ELSE tags->'service' END AS service
				  FROM &prefix;_line
				 WHERE tags->'highway' IN ('residential', 'unclassified', 'service')
				   AND &date;
				
			) as subq
			</Parameter>
			
			&datasource-settings;
		</Datasource>
	</Layer>
	
	<Layer name="roads-minor-area" status="on" srs="&dbProjection;">
		<StyleName>roads-residential-area-casing</StyleName>
		<StyleName>roads-residential-area-fill</StyleName>
		
		
		<Datasource>
			<Parameter name="table">
			(
			
				SELECT way, tags->'highway' AS highway
				  FROM &prefix;_polygon
				 WHERE tags->'highway' IN ('residential', 'unclassified', 'service')
				   AND &date;
				
			) as subq
			</Parameter>
			
			&datasource-settings;
		</Datasource>
	</Layer>
	
	<xi:include href="roads/residential.xml" xpointer="area-casing" />
	<xi:include href="roads/residential.xml" xpointer="bridge-casing" />
	<xi:include href="roads/residential.xml" xpointer="tunnel-casing" />
	<xi:include href="roads/residential.xml" xpointer="casing" />
	
	<xi:include href="roads/residential.xml" xpointer="area-fill" />
	<xi:include href="roads/residential.xml" xpointer="tunnel-fill" />
	<xi:include href="roads/residential.xml" xpointer="bridge-fill" />
	<xi:include href="roads/residential.xml" xpointer="fill" />
	
	<xi:include href="roads/residential.xml" xpointer="construction" />
	<xi:include href="roads/residential.xml" xpointer="access" />
	<xi:include href="roads/residential.xml" xpointer="text" />
</Include>